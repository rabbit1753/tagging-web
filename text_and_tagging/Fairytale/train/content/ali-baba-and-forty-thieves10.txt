to exact revenge , after some time the thief establishes himself as a merchant , befriends ali baba 's son ( who is now in charge of the late cassim 's business ) , and is invited to dinner at ali baba 's house . the thief is recognized by morgiana , who performs a dance with a dagger for the diners and plunges it into the heart of the thief when he is off his guard . ali baba is at first angry with morgiana , but when he finds out the thief tried to kill him , he gives morgiana her freedom and marries her to his son . ali baba is then left as the only one knowing the secret of the treasure in the cave and how to access it . thus , the story ends happily for everyone except the forty thieves and cassim .