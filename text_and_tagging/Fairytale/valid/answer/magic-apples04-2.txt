he took his magic cap and wished himself into the castle .